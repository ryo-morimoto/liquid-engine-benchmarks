<div class="form-builder">
  <header class="form-header">
    <h1>{{ form.title | default: "Contact Form" }}</h1>
    {% if form.description %}
      <p class="form-description">{{ form.description }}</p>
    {% endif %}
  </header>

  <form action="{{ form.action | default: '/submit' }}" method="{{ form.method | default: 'post' }}" class="dynamic-form">
    {% for field in form.fields %}
      <div class="form-group {{ field.type }}-field {% if field.required %}required{% endif %}">
        <label for="{{ field.name }}">
          {{ field.label }}
          {% if field.required %}<span class="required-mark">*</span>{% endif %}
        </label>

        {% case field.type %}
          {% when "text" %}
            <input
              type="text"
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
              {% if field.required %}required{% endif %}
              {% if field.maxlength %}maxlength="{{ field.maxlength }}"{% endif %}
              {% if field.default %}value="{{ field.default }}"{% endif %}
            >

          {% when "email" %}
            <input
              type="email"
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
              {% if field.required %}required{% endif %}
              {% if user.email %}value="{{ user.email }}"{% endif %}
            >

          {% when "phone" %}
            <input
              type="tel"
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
              {% if field.required %}required{% endif %}
              {% if field.pattern %}pattern="{{ field.pattern }}"{% endif %}
            >

          {% when "textarea" %}
            <textarea
              id="{{ field.name }}"
              name="{{ field.name }}"
              rows="{{ field.rows | default: 5 }}"
              {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
              {% if field.required %}required{% endif %}
              {% if field.maxlength %}maxlength="{{ field.maxlength }}"{% endif %}
            >{{ field.default }}</textarea>

          {% when "select" %}
            <select
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.required %}required{% endif %}
            >
              {% if field.placeholder %}
                <option value="" disabled selected>{{ field.placeholder }}</option>
              {% endif %}
              {% for option in field.options %}
                <option
                  value="{{ option.value }}"
                  {% if option.value == field.default %}selected{% endif %}
                >
                  {{ option.label }}
                </option>
              {% endfor %}
            </select>

          {% when "radio" %}
            <div class="radio-group">
              {% for option in field.options %}
                <label class="radio-label">
                  <input
                    type="radio"
                    name="{{ field.name }}"
                    value="{{ option.value }}"
                    {% if option.value == field.default %}checked{% endif %}
                    {% if field.required %}required{% endif %}
                  >
                  {{ option.label }}
                </label>
              {% endfor %}
            </div>

          {% when "checkbox" %}
            {% if field.options %}
              <div class="checkbox-group">
                {% for option in field.options %}
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      name="{{ field.name }}[]"
                      value="{{ option.value }}"
                    >
                    {{ option.label }}
                  </label>
                {% endfor %}
              </div>
            {% else %}
              <label class="checkbox-label single">
                <input
                  type="checkbox"
                  name="{{ field.name }}"
                  value="1"
                  {% if field.required %}required{% endif %}
                >
                {{ field.checkbox_label | default: field.label }}
              </label>
            {% endif %}

          {% when "date" %}
            <input
              type="date"
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.min %}min="{{ field.min }}"{% endif %}
              {% if field.max %}max="{{ field.max }}"{% endif %}
              {% if field.required %}required{% endif %}
            >

          {% when "number" %}
            <input
              type="number"
              id="{{ field.name }}"
              name="{{ field.name }}"
              {% if field.min %}min="{{ field.min }}"{% endif %}
              {% if field.max %}max="{{ field.max }}"{% endif %}
              {% if field.step %}step="{{ field.step }}"{% endif %}
              {% if field.required %}required{% endif %}
              {% if field.default %}value="{{ field.default }}"{% endif %}
            >

          {% when "hidden" %}
            <input type="hidden" name="{{ field.name }}" value="{{ field.value }}">

        {% endcase %}

        {% if field.help %}
          <span class="help-text">{{ field.help }}</span>
        {% endif %}
      </div>
    {% endfor %}

    <div class="form-actions">
      <button type="submit" class="submit-button">
        {{ form.submit_text | default: "Submit" }}
      </button>
      {% if form.show_reset %}
        <button type="reset" class="reset-button">Reset</button>
      {% endif %}
    </div>
  </form>

  {% if form.privacy_notice %}
    <p class="privacy-notice">{{ form.privacy_notice }}</p>
  {% endif %}
</div>
